@{ ViewData["Title"] = "Carrinho"; }


<link rel="stylesheet" href="~/lib/bootstrap-ecommerce-uikit/css/ui.css" />
<link rel="stylesheet" href="~/lib/bootstrap-ecommerce-uikit/css/responsive.css" media="only screen and (max-width: 1200px)" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" />



<section class="container" id="order" style="margin-top: 50px">
    <div id="code_cart">
        <div class="card">
            <table class="table table-hover shopping-cart-wrap">
                <thead class="text-muted">
                    <tr>
                        <th scope="col">Produto</th>
                        <th scope="col" width="120">Quantidade</th>
                        <th scope="col" width="120">Preço</th>
                        <th scope="col" width="200" class="text-right"></th>
                    </tr>
                </thead>
                <tbody id="idcarrinho">
                </tbody>
                <tfoot class="text-muted">
                    <tr>
                        <th scope="col"></th>
                        <th  scope="col" width="120"></th>
                        <th scope="col" width="230" class="text-right">Quantidade Total de Produtos:</th>
                        <th id="QuantidadeTotalProduto" scope="col" width="90"></th>
                    </tr>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col" width="120"></th>
                        <th scope="col" width="230" class="text-right">Valor Total dos Produtos:</th>
                        <th id="ValorTotalProduto" scope="col" width="90"></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</section>
<br />
<br />


<h6>Calculo de frete</h6>

<div class="row">
    <div class="col-md-2">
        <label>CEP: </label>
        <input id="txt_cep" type="text" name="CEP"><br><br>
    </div>
    <div class="col-md-2">
        <label>Escolha o tipo de envio:</label>
        <select id="txt_servico" type="text" class="form-control">
            <option value="04510">PAC</option>
            <option value="04014">SEDEX</option>
        </select>
    </div>
    <div>
        <button id="btn_Calcular" type="button" class="btn btn-primary btn-sm">Calcular</button>
    </div>

</div>
<hr />
<p>Valor total: <span id="RespFrete"></span></p>
<hr />
<button type="submit" class="btn btn-primary">Finalizar</button>
<hr/>


<script>
    $(document).ready(function () {
        $("#btn_Calcular").click(function () {
            Calcular($("#txt_cep").val(), $("#txt_servico").val());
        });

        GetCarrinho();

    });

    function Calcular(_cep, _servico) {
        $("#RespFrete").html("Aguarde...");
        var _url = '@Url.Action("GetCalculo", "CalculaFrete")';

        $.ajax({
            url: _url,
            type: 'GET',
            data: {
                cep : _cep,
                cdservico : _servico,
            },
            processData: true,
            contentType: true,
            success: function (result) {
    
                
                $("#RespFrete").html(result.resposta);

            }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            },
        });
    }

    function GetCarrinho() {

        var tb = "";
        var Total = 0;
        var Quantidade = 0;
        $("#idcarrinho").html("");
        var _url = '@Url.Action("GetAll", "Carrinho")';

        $.ajax({
            url: _url,
            type: 'GET',
            processData: true,
            contentType: true,
            success: function (result) {
                if (result.success) {
                    tb = "<tr>";
                    $.each(result.resp, function (i, item) {

                        tb += "<td><figure class='media'>";
                        tb += "<div class='img-wrap'><img src='~/img/em_casa_logo_v.png'class='img-thumbnail img-sm'></div>";
                        tb += "<figcaption class='media-body'>";
                        tb += "<h6 class='title text-truncate'>" + item.nome + "</h6>";
                        tb += "<dl class='dlist-inline small'><dt>Tamanho: </dt><dd>" + item.tamanho + "</dd></dl>";
                        tb += "<dl class='dlist-inline small'><dt>Cor: </dt><dd>" + item.cor + "</dd></dl>";
                        tb += "</figcaption></figure ></td>";
                        tb += "<td>" + item.quantidade + " </td>";
                        tb += "<td><div class='price-wrap'><var class='price'>" + item.quantidade * item.preco + "</var>";
                        tb += "<small class='text-muted'>(" + item.preco + " cada)</small></div></td>";
                        tb += "<td class='text-right'><a href='##' onclick='RemoveItem(" + item.id + ");'>Remover</a></td>";
                        tb += "</tr>";
                        Total += item.preco * item.quantidade;
                        Quantidade += item.quantidade;
                        console.log("Valor Total:", Total);
                        $("#ValorTotalProduto").html(Total);
                        $("#QuantidadeTotalProduto").html(Quantidade);
                    });

                    $("#idcarrinho").html(tb);


                }
            }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            }

        });

    }

      function RemoveItem(codigo) {
        var _url = '@Url.Action("RemoveItem", "Carrinho")';

        $.ajax({
            url: _url,
            type: 'GET',
            data: {
                Id: codigo
            },
            processData: true,
            contentType: true,
            success: function (result) {
                GetCarrinho();
            }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            }

        });
      }


</script>

    