
@{
    @model ProdutoView;
}

<link href="~/css/pdp.css" rel="stylesheet">

<div class="card">
    <div class="row">
        <aside class="col-md-6">
            <article class="gallery-wrap">
                <div class="product-slider-single normal-slider">
                    @{
                        var iCont = 1;
                    }
                    @foreach (var foto in Model.produtofotoModel)
                    {
                        @if (foto.Caminho != "")
                        {
                            <img id="foto_@iCont" src="@foto.Descricao" alt="Product Image">
                        }
                        iCont++;
                    }
                </div>
                <div class="product-slider-single-nav normal-slider">
                    @foreach (var foto in Model.produtofotoModel)
                    {
                        @if (foto.Caminho != "")
                        {
                            <div class="slider-nav-img"><img class="img-sm" src="@foto.Descricao" alt="Product Image"></div>
                        }
                    }
                </div>
            </article>
        </aside>
        <main class="col-md-6 border-left" style="padding: 2em 2em;">
            <article class="content-body">

                <h2 class="title">@Model.tb_produto.Nome</h2>

                <div class="mb-3">
                    <var id="txt_preco" class="price h4">@Model.tb_produto.Valor.ToString("C")</var>
                </div>

                <p>@Model.tb_produto.Descricao</p>

                <dl class="row">
                    <dt class="col-sm-4">Código do produto</dt>
                    <dd class="col-sm-8">@Model.tb_produto.CodigoInterno</dd>

                    <dt class="col-sm-4">Cor</dt>
                    <select id="txt_cor" class="form-control col-sm-5" style="width:130px">

                        @foreach (var Cor in Model.produtocorModel)
                        {
                            <option class="col-sm-8">@Cor.Descricao</option>
                        }
                    </select>

                    <br />
                    <br />

                    <dt class="col-sm-4">Tamanho</dt>
                    <select id="txt_tamanho" class="form-control col-sm-5" style="width:70px">
                        @foreach (var Tamanho in Model.produtotamanhoModel)
                        {
                            <option class="col-sm-8">@Tamanho.Descricao</option>
                        }
                    </select>

                    <br />
                    <br />

                    <dt class="col-sm-4">Quantidade</dt>
                    <select id="txt_quantidade" class="form-control" style="width:70px">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                    </select>

                </dl>

                <hr>

                <a  href="../Carrinho" onclick="AddCar();" class="btn  btn-outline-primary"> Carrinho </a>
                <a href="#" class="btn  btn-outline-primary" onclick="AddCar();"> <span class="text">Adicionar ao carrinho</span> <i class="fas fa-shopping-cart"></i>  </a>
            </article> <!-- product-info-aside .// -->
        </main> <!-- col.// -->
    </div> <!-- row.// -->
</div>

<script src="~/lib/slick/slick.min.js"></script>
<script src="~/js/pdp.js"></script>

<script>

    $(document).ready(function () {
        GetCarrinho();
    });

    function AddCar() {

        var _tamanho = $("#txt_tamanho option:selected").val();
        var _cor = $("#txt_cor option:selected").val();
        var _quantidade = $("#txt_quantidade option:selected").val();
        var _url = '@Url.Action("AddCar", "Carrinho")';


        $.ajax({
            url: _url,
            type: 'GET',
            data: {
                CodigoProduto: '@Model.tb_produto.CodigoProduto',
                Nome: '@Model.tb_produto.Nome',
                Peso: '@Model.tb_produto.Peso',
                Tamanho: _tamanho,
                Preco: '@Model.tb_produto.Valor',
                Cor: _cor,
                Quantidade: _quantidade,
            },

            processData: true,
            contentType: true,
            success: function (result) {
                GetCarrinho();
            }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            }

        });
    }

    function GetCarrinho() {

        var tb ="";
        $("#idcarrinho").html("");
        var _url = '@Url.Action("GetAll", "Carrinho")';

        $.ajax({
            url: _url,
            type: 'GET',
            processData: true,
            contentType: true,
            success: function (result) {
                if (result.success) {

                    tb = "<table class='table'>";
                    $.each(result.resp, function (i, item) {
                        var f2 = item.preco.toLocaleString('pt-br', { style: "currency", currency: "BRL", minimumFractionDigits: 2 });
                        tb += "<tr>";
                        tb += "<td>" + item.nome + "</td>";
                        tb += "<td>" + item.quantidade + "</td>";
                        tb += "<td>" + item.tamanho + "</td>";
                        tb += "<td>" + f2 + "</td>";
                        tb += "<td>" + item.cor + "</td>";
                        tb += "<td><a href='##' onclick='RemoveItem(" + item.id + ");'>Remover</a></td>";
                        tb += "</tr>";
                    });
                    tb += "</table>";
                    $("#idcarrinho").html(tb);
                }

             }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            }
        });
        //console.log("Depois", '@Model.tb_produto.Valor.ToString("C")');

    }





    function RemoveItem(codigo) {
        var _url = '@Url.Action("RemoveItem", "Carrinho")';

        $.ajax({
            url: _url,
            type: 'GET',
            data: {
                Id: codigo
            },
            processData: true,
            contentType: true,
            success: function (result) {
                GetCarrinho();
            }
            ,
            error: function (jqXHR) {

            },
            complete: function (jqXHR, status) {

            }

        });
    }

</script>